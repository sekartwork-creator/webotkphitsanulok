<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
body { font-family: 'Sarabun', sans-serif; background:#f5f5f5; padding:20px; }
.site-header { background:#06C755; color:#fff; padding:15px 20px; }
.site-header h1 { margin:0; font-size:22px; }
.site-header nav a { color:#fff; text-decoration:none; margin-left:15px; padding:6px 12px; border-radius:6px; transition:0.3s; }
.site-header nav a:hover { background:#05a64a; }
.articles { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:15px; margin-top:20px; }
.article-wrapper { border-radius:10px; overflow:hidden; box-shadow:0 3px 8px rgba(0,0,0,0.12); background:#fff; transition:0.2s; }
.article-wrapper:hover { transform:translateY(-4px); }
.article-wrapper figure { margin:0; height:140px; overflow:hidden; }
.article-wrapper img { width:100%; height:100%; object-fit:cover; }
.article-body { padding:10px; }
.article-body h2 { font-size:1rem; margin-bottom:6px; display:flex; justify-content:space-between; align-items:center;}
.toggle-content { display:none; margin-top:8px; font-size:0.9rem; }
.toggle-btn { border:none; background:none; font-size:18px; cursor:pointer; transition: transform 0.3s ease; }
.toggle-btn.rotate { transform:rotate(180deg); }
</style>
</head>
<body>

<header class="site-header">
  <div class="d-flex justify-content-between align-items-center">
    <h1>LINE Official Account</h1>
    <nav>
      <a href="#" id="addTenantBtn" style="background:#fff;color:#06C755;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</a>
    </nav>
  </div>
</header>

<div class="container mt-4">
  <div class="d-flex justify-content-between mb-3">
    <input type="text" id="searchBox" class="form-control w-50" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤...">
    <button class="btn btn-secondary" onclick="loadTenants()">‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
  </div>
  <section class="articles" id="tenantCards"></section>
</div>

<script>
// ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢
function formatDateThai(dateStr){
  if(!dateStr) return "";
  const months=["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
                "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
  const d=new Date(dateStr);
  return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()+543}`;
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤
function loadTenants() {
  google.script.run.withSuccessHandler(function(tenants){
    const container = document.getElementById("tenantCards");
    const keyword = document.getElementById("searchBox").value.toLowerCase();
    container.innerHTML = "";

    tenants.forEach((t,i)=>{
      if(!keyword || t.name.toLowerCase().includes(keyword) ||
         t.contractNo.toLowerCase().includes(keyword) ||
         t.phone.toLowerCase().includes(keyword)) {

        container.innerHTML += `
<article>
  <div class="article-wrapper">
    <figure><img src="${t.image||'https://picsum.photos/seed/'+i+'/800/450'}" alt="${t.name}"></figure>
    <div class="article-body">
      <h2>${t.name} <button class="toggle-btn">‚ñº</button></h2>
      <div class="toggle-content">
        <p>
          <b>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤:</b> ${t.contractNo||"-"}<br>
          <b>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</b> ${t.address||"-"}<br>
          <b>‡πÇ‡∏ó‡∏£:</b> ${t.phone||"-"}<br>
          <b>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</b> ${t.email||"-"}<br>
          <b>‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</b> ${formatDateThai(t.startDate)}<br>
          <b>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</b> ${t.duration||"-"} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô<br>
          <b>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤:</b> ${t.rentRate||"-"} ‡∏ö‡∏≤‡∏ó<br>
          <b>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ:</b> ${t.annualIncome||"-"} ‡∏ö‡∏≤‡∏ó<br>
          <b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> ${t.rentType||"-"}<br>
          <b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</b> ${t.note||"-"}
        </p>
        <a href="#" onclick="editTenant(${t.index})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</a> | 
        <a href="#" onclick="deleteTenant(${t.index})">üóëÔ∏è ‡∏•‡∏ö</a>
      </div>
    </div>
  </div>
</article>`;
      }
    });

    document.querySelectorAll(".toggle-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const content = btn.closest(".article-body").querySelector(".toggle-content");
        const isOpen = content.style.display === "block";
        content.style.display = isOpen ? "none" : "block";
        btn.classList.toggle("rotate", !isOpen);
      });
    });

  }).getAllTenants();
}

document.getElementById("searchBox").addEventListener("keyup", loadTenants);
window.onload = loadTenants;

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤
document.getElementById("addTenantBtn").addEventListener("click", ()=>{
  Swal.fire({
    title:'‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤',
    html:`
<input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
<input id="swal-address" class="swal2-input" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà">
<input id="swal-contract" class="swal2-input" placeholder="‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏™‡∏±‡∏ç‡∏ç‡∏≤">
<input id="swal-phone" class="swal2-input" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
<input id="swal-email" class="swal2-input" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
<input type="date" id="swal-startDate" class="swal2-input">
<input id="swal-duration" class="swal2-input" placeholder="‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)">
<input id="swal-rentRate" class="swal2-input" placeholder="‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)">
<input id="swal-annualIncome" class="swal2-input" placeholder="‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡πà‡∏≠‡∏õ‡∏µ">
<input id="swal-rentType" class="swal2-input" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤">
<input id="swal-note" class="swal2-input" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏">
<input id="swal-image" class="swal2-input" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û">
    `,
    showCancelButton:true,
    confirmButtonText:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
  }).then(result=>{
    if(result.isConfirmed){
      const tenant = {
        name:document.getElementById('swal-name').value,
        address:document.getElementById('swal-address').value,
        contractNo:document.getElementById('swal-contract').value,
        phone:document.getElementById('swal-phone').value,
        email:document.getElementById('swal-email').value,
        startDate:document.getElementById('swal-startDate').value,
        duration:document.getElementById('swal-duration').value,
        rentRate:document.getElementById('swal-rentRate').value,
        annualIncome:document.getElementById('swal-annualIncome').value,
        rentType:document.getElementById('swal-rentType').value,
        note:document.getElementById('swal-note').value,
        image:document.getElementById('swal-image').value
      };
      google.script.run.withSuccessHandler(()=>{
        Swal.fire({icon:'success', title:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer:1500, showConfirmButton:false});
        loadTenants();
      }).addTenant(tenant);
    }
  });
});

// ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤
function editTenant(index){
  google.script.run.withSuccessHandler(function(tenants){
    const t = tenants[index];
    Swal.fire({
      title:'‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤',
      html:`
<input id="swal-name" class="swal2-input" value="${t.name}">
<input id="swal-address" class="swal2-input" value="${t.address}">
<input id="swal-contract" class="swal2-input" value="${t.contractNo}">
<input id="swal-phone" class="swal2-input" value="${t.phone}">
<input id="swal-email" class="swal2-input" value="${t.email}">
<input type="date" id="swal-startDate" class="swal2-input" value="${t.startDate}">
<input id="swal-duration" class="swal2-input" value="${t.duration}">
<input id="swal-rentRate" class="swal2-input" value="${t.rentRate}">
<input id="swal-annualIncome" class="swal2-input" value="${t.annualIncome}">
<input id="swal-rentType" class="swal2-input" value="${t.rentType}">
<input id="swal-note" class="swal2-input" value="${t.note}">
<input id="swal-image" class="swal2-input" value="${t.image}">
      `,
      showCancelButton:true,
      confirmButtonText:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'
    }).then(result=>{
      if(result.isConfirmed){
        const updated = {
          name:document.getElementById('swal-name').value,
          address:document.getElementById('swal-address').value,
          contractNo:document.getElementById('swal-contract').value,
          phone:document.getElementById('swal-phone').value,
          email:document.getElementById('swal-email').value,
          startDate:document.getElementById('swal-startDate').value,
          duration:document.getElementById('swal-duration').value,
          rentRate:document.getElementById('swal-rentRate').value,
          annualIncome:document.getElementById('swal-annualIncome').value,
          rentType:document.getElementById('swal-rentType').value,
          note:document.getElementById('swal-note').value,
          image:document.getElementById('swal-image').value
        };
        google.script.run.withSuccessHandler(()=>{
          Swal.fire({icon:'success', title:'‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer:1500, showConfirmButton:false});
          loadTenants();
        }).updateTenant(index, updated);
      }
    });
  }).getAllTenants();
}

// ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤
function deleteTenant(index){
  Swal.fire({
    title:"‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
    text:"‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!",
    icon:"warning",
    showCancelButton:true,
    confirmButtonText:"‡∏•‡∏ö",
    cancelButtonText:"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
  }).then(result=>{
    if(result.isConfirmed){
      google.script.run.withSuccessHandler(()=>{
        Swal.fire({icon:'success', title:'‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer:1500, showConfirmButton:false});
        loadTenants();
      }).deleteTenant(index);
    }
  });
}
</script>

</body>
</html>
